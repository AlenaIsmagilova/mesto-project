(()=>{"use strict";var t,e=document.querySelector(".profile__button"),o=document.querySelector("#popupEdit"),n=document.querySelector("#popupAdd"),r=document.querySelector("#popupEditAvatar"),c=document.querySelector("#inputProf"),a=(document.querySelectorAll("#inputFirstname"),document.querySelector(".profile__name")),u=document.querySelector(".profile__subtitle"),i=document.querySelector("#editForm"),s=document.querySelector("#addForm"),d=document.querySelector(".profile__button-added"),l=document.querySelector("#inputPlace"),p=document.querySelector("#inputLink"),f=document.querySelector("#popupImage"),m=(document.querySelector(".popup__container"),document.querySelector(".popup__image")),h=document.querySelector(".popup__caption"),_=document.querySelector("#card").content,v=document.querySelector(".cards__list"),y=document.querySelector(".profile__avatar"),b=document.querySelector(".profile__avatar-edit"),S=document.querySelector("#inputLinkEditAvatar"),q=document.querySelector(".profile__avatar"),E=document.querySelector("#editAvatarForm"),L=document.querySelector(".form__input"),k=document.querySelectorAll(".popup"),g=document.querySelector("#popupDeleteCard"),C=document.querySelector("#deleteCardButton"),A=document.querySelectorAll(".form__button"),j=function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},P=function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},x=function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/".concat(t),{method:"DELETE",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))};function T(t,e,o,n,r,c){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=_.querySelector(".cards__item").cloneNode(!0),i=u.querySelector(".cards__button"),s=u.querySelector(".cards__image"),d=u.querySelector(".cards__likes"),l=u.querySelector(".cards__button-delete");l.addEventListener("click",(function(){z(g),C.addEventListener("click",(function(){x(c).then((function(){u.remove(),w(g)}))}))})),n!==r&&l.classList.add("cards__button-delete_type_inactive"),d.textContent=o,u.querySelector(".cards__title").textContent=e,s.setAttribute("src",t),s.setAttribute("alt",e),i.addEventListener("click",(function(t){t.target.classList.contains("cards__button_active")?P(c).then((function(t){i.classList.remove("cards__button_active"),d.textContent=t.likes.length})).catch((function(t){console.log(t)})):j(c).then((function(t){i.classList.add("cards__button_active"),d.textContent=t.likes.length})).catch((function(t){console.log(t)}))}));var p=a.some((function(t){return t._id===n}));return p&&i.classList.add("cards__button_active"),s.addEventListener("click",(function(o){o.stopPropagation(),z(f),m.setAttribute("src",t),m.setAttribute("alt",e),h.textContent=e})),u}function w(t){t.classList.remove("popup_opened"),window.removeEventListener("keydown",D)}function z(t){t.classList.add("popup_opened"),window.addEventListener("keydown",D)}function D(t){"Escape"===t.key&&w(document.querySelector(".popup_opened"))}function F(t){A.forEach((function(e){e.textContent=t?"Сохранение...":"Сохранить"}))}k.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&w(t),e.target.classList.contains("popup__button-closed")&&w(t)}))})),t={formElement:".form",formInput:".form__input",submitButtonSelector:".form__button",inputErrorClass:".form__input-error_active",errorClass:".form__input_type_error"},Array.from(document.querySelectorAll(t.formElement)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Array.from(t.querySelectorAll(e.formInput)),n=t.querySelector(e.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.errorClass.substring(1)),n.classList.remove(o.inputErrorClass.substring(1)),n.textContent=""}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.errorClass.substring(1)),r.textContent=o,r.classList.add(n.inputErrorClass.substring(1))}(t,e,e.validationMessage,o)}(t,r,e),function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}(o,n)}))}))}(e,t)})),i.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0),(e={name:L.value,about:c.value},fetch("https://nomoreparties.co/v1/plus-cohort-9/users/me",{method:"PATCH",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b","Content-Type":"application/json"},body:JSON.stringify(e)})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){a.textContent=t.name,u.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){return F(!1)})),w(o)})),s.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0),w(n),(e={name:l.value,link:p.value},fetch("https://nomoreparties.co/v1/plus-cohort-9/cards",{method:"POST",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b","Content-Type":"application/json"},body:JSON.stringify(e)})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){console.log(e);var o=T(e.link,e.name,e.likes.length,e.owner._id,e.owner._id,e._id);v.prepend(o),s.reset(),t.submitter.setAttribute("disabled",!0)})).catch((function(t){console.log(t)})).finally((function(){return F(!1)}))})),E.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0),(e={avatar:S.value},fetch("https://nomoreparties.co/v1/plus-cohort-9/users/me/avatar",{method:"PATCH",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b","Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){q.setAttribute("src",e.avatar),w(r),S.value="",t.submitter.setAttribute("disabled",!0)})).catch((function(t){console.log(t)})).finally((function(){return F(!1)}))})),e.addEventListener("click",(function(t){t.stopPropagation(),z(o),L.value=a.textContent,c.value=u.textContent})),b.addEventListener("click",(function(t){t.stopPropagation(),z(r)})),d.addEventListener("click",(function(t){t.stopPropagation(),z(n)})),fetch("https://nomoreparties.co/v1/plus-cohort-9/users/me",{method:"GET",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){fetch("https://nomoreparties.co/v1/plus-cohort-9/cards",{method:"GET",headers:{authorization:"9657f4a3-a3d3-4b6a-aa7c-51c28c9ee53b"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){e.forEach((function(e){var o=T(e.link,e.name,e.likes.length,t._id,e.owner._id,e._id,e.likes);v.append(o),a.textContent=t.name,u.textContent=t.about,y.setAttribute("src",t.avatar)}))})).catch((function(t){console.log(t)}))}))})();